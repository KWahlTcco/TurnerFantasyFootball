<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fantasy Football Commissioner Console</title>
  <style>
    :root{
      --bg:#050a12;
      --panel:rgba(15,22,40,.65);
      --panel2:rgba(10,16,32,.8);
      --text:#f0f4ff;
      --muted:#8892a8;
      --border:rgba(255,255,255,.08);
      --accent:#6366f1;
      --accent2:#22d3ee;
      --danger:#f43f5e;
      --good:#10b981;
      --warn:#f59e0b;
      --glow: 0 0 40px rgba(99,102,241,.3);
      --shadow: 0 25px 50px -12px rgba(0,0,0,.5);
      --radius:20px;
      --radius2:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      --sans: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
    }
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    *{box-sizing:border-box}
    html,body{height:100%;overflow-x:hidden}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:var(--bg);
      position:relative;
    }
    body::before{
      content:'';
      position:fixed;
      inset:0;
      background:
        radial-gradient(ellipse 80% 50% at 20% -10%, rgba(99,102,241,.25), transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 110%, rgba(34,211,238,.15), transparent 50%),
        radial-gradient(ellipse 40% 30% at 50% 50%, rgba(99,102,241,.05), transparent);
      pointer-events:none;
      z-index:0;
    }
    .orb{
      position:fixed;
      border-radius:50%;
      filter:blur(80px);
      opacity:.4;
      pointer-events:none;
      z-index:0;
      animation: float 20s ease-in-out infinite;
    }
    .orb1{width:500px;height:500px;background:var(--accent);top:-200px;left:-100px;animation-delay:0s}
    .orb2{width:400px;height:400px;background:var(--accent2);bottom:-150px;right:-100px;animation-delay:-7s}
    .orb3{width:300px;height:300px;background:#a855f7;top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:-14s}
    @keyframes float{
      0%,100%{transform:translate(0,0) scale(1)}
      33%{transform:translate(30px,-30px) scale(1.05)}
      66%{transform:translate(-20px,20px) scale(.95)}
    }

    a{color:inherit}

    header{
      position:sticky;top:0;z-index:10;
      backdrop-filter:blur(20px) saturate(180%);
      background:rgba(5,10,18,.7);
      border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:20px;position:relative;z-index:1}
    .topbar{display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;gap:14px;align-items:center;min-width:0}
    .logo{
      width:48px;height:48px;border-radius:16px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:var(--glow);
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:'üèà';
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:24px;
    }
    .titleblock{min-width:0}
    .title{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .title h1{font-size:20px;margin:0;font-weight:700;letter-spacing:-.02em}
    .title .pill{
      font-size:11px;color:var(--accent2);font-weight:600;
      background:rgba(34,211,238,.1);
      padding:5px 10px;border-radius:999px;
      border:1px solid rgba(34,211,238,.2);
    }
    .subtitle{margin:4px 0 0;color:var(--muted);font-size:13px}

    .actions{display:flex;gap:8px;flex-wrap:wrap}

    .btn{
      appearance:none;border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      backdrop-filter:blur(10px);
      color:var(--text);
      padding:10px 14px;border-radius:12px;
      cursor:pointer;
      display:inline-flex;gap:8px;align-items:center;
      transition:all .2s cubic-bezier(.4,0,.2,1);
      font-weight:600;font-size:13px;
      position:relative;overflow:hidden;
    }
    .btn::before{
      content:'';position:absolute;inset:0;
      background:linear-gradient(135deg,rgba(255,255,255,.1),transparent);
      opacity:0;transition:opacity .2s;
    }
    .btn:hover{
      border-color:rgba(99,102,241,.5);
      transform:translateY(-2px);
      box-shadow:0 10px 30px -10px rgba(99,102,241,.3);
    }
    .btn:hover::before{opacity:1}
    .btn:active{transform:translateY(0)}
    .btn.primary{
      background:linear-gradient(135deg,var(--accent),#8b5cf6);
      border-color:transparent;
      box-shadow:0 4px 20px -5px rgba(99,102,241,.5);
    }
    .btn.primary:hover{box-shadow:0 8px 30px -5px rgba(99,102,241,.6);transform:translateY(-2px)}
    .btn.danger{background:rgba(244,63,94,.15);border-color:rgba(244,63,94,.3)}
    .btn.danger:hover{border-color:rgba(244,63,94,.6);box-shadow:0 10px 30px -10px rgba(244,63,94,.3)}
    .btn.ghost{background:transparent}
    .btn.small{padding:8px 12px;border-radius:10px}
    .btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}

    .grid{
      display:grid;
      grid-template-columns:260px 1fr;
      gap:20px;
      padding-top:20px;
    }
    @media(max-width:960px){.grid{grid-template-columns:1fr}}

    .panel{
      background:var(--panel);
      backdrop-filter:blur(20px) saturate(180%);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      transition:all .3s ease;
    }
    .panel:hover{border-color:rgba(255,255,255,.12)}
    .panel .hd{
      padding:16px 18px;
      border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      background:rgba(255,255,255,.02);
    }
    .panel .hd h2{margin:0;font-size:12px;font-weight:700;letter-spacing:.1em;color:var(--muted);text-transform:uppercase}
    .panel .bd{padding:18px}

    .nav{display:flex;flex-direction:column;gap:4px;padding:12px}
    .tab{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;padding:12px 14px;
      border:1px solid transparent;border-radius:14px;
      cursor:pointer;color:var(--text);background:transparent;
      transition:all .2s ease;position:relative;overflow:hidden;
    }
    .tab small{color:var(--muted);font-size:12px;font-weight:500}
    .tab::before{
      content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);
      width:3px;height:0;background:var(--accent);border-radius:2px;
      transition:height .2s ease;
    }
    .tab[aria-selected="true"]{
      background:linear-gradient(135deg,rgba(99,102,241,.15),rgba(139,92,246,.1));
      border-color:rgba(99,102,241,.3);
    }
    .tab[aria-selected="true"]::before{height:60%}
    .tab:hover{background:rgba(255,255,255,.05)}

    .content{min-height:540px}

    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .row.space{justify-content:space-between}

    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:16px}
    @media(max-width:680px){.kpi{grid-template-columns:1fr}}
    .card{
      background:linear-gradient(145deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
      border:1px solid var(--border);border-radius:var(--radius2);
      padding:18px;
      display:flex;flex-direction:column;gap:8px;
      position:relative;overflow:hidden;
      transition:all .3s ease;
    }
    .card::before{
      content:'';position:absolute;top:0;left:0;right:0;height:2px;
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      opacity:0;transition:opacity .3s;
    }
    .card:hover{transform:translateY(-4px);border-color:rgba(99,102,241,.3)}
    .card:hover::before{opacity:1}
    .card .label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.05em;font-weight:600}
    .card .value{font-size:32px;font-weight:800;letter-spacing:-.02em;background:linear-gradient(135deg,var(--text),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .card .note{font-size:12px;color:var(--muted)}

    .tablewrap{overflow:auto;border:1px solid var(--border);border-radius:16px;background:rgba(0,0,0,.2)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px 14px;border-bottom:1px solid var(--border);text-align:left;font-size:13px}
    th{background:rgba(255,255,255,.03);color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.05em;font-size:11px}
    tbody tr{transition:background .2s}
    tr:hover td{background:rgba(99,102,241,.05)}
    td.num{text-align:right;font-variant-numeric:tabular-nums;font-family:var(--mono)}
    .nowrap{white-space:nowrap}

    .chip{
      display:inline-flex;align-items:center;gap:6px;
      background:rgba(255,255,255,.05);
      border:1px solid var(--border);
      padding:5px 10px;border-radius:999px;
      font-size:11px;font-weight:600;color:var(--muted);
      transition:all .2s;
    }
    .chip.good{border-color:rgba(16,185,129,.4);color:var(--good);background:rgba(16,185,129,.1)}
    .chip.warn{border-color:rgba(245,158,11,.4);color:var(--warn);background:rgba(245,158,11,.1)}
    .chip.bad{border-color:rgba(244,63,94,.4);color:var(--danger);background:rgba(244,63,94,.1)}

    .form{display:grid;gap:14px}
    .field{display:grid;gap:6px}
    label{font-size:11px;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:.05em}
    input,select,textarea{
      width:100%;border:1px solid var(--border);
      background:rgba(0,0,0,.3);color:var(--text);
      padding:12px 14px;border-radius:12px;outline:none;
      font-size:14px;transition:all .2s;
    }
    textarea{min-height:100px;resize:vertical}
    input:focus,select:focus,textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(99,102,241,.15)}
    .hint{color:var(--muted);font-size:12px;line-height:1.5}

    .split{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media(max-width:680px){.split{grid-template-columns:1fr}}

    dialog{
      width:min(720px,calc(100vw - 32px));
      border:none;border-radius:24px;padding:0;
      background:rgba(15,22,40,.95);
      backdrop-filter:blur(30px);
      color:var(--text);
      box-shadow:0 50px 100px -20px rgba(0,0,0,.7);
      animation:modalIn .3s ease;
    }
    @keyframes modalIn{from{opacity:0;transform:scale(.95) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
    dialog::backdrop{background:rgba(0,0,0,.7);backdrop-filter:blur(4px)}
    .modal-hd{padding:18px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .modal-hd h3{margin:0;font-size:16px;font-weight:700}
    .modal-bd{padding:20px}
    .modal-ft{padding:16px 20px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:10px}

    .empty{
      padding:24px;border:1px dashed rgba(255,255,255,.15);
      border-radius:16px;color:var(--muted);
      background:rgba(0,0,0,.2);text-align:center;
    }
    .empty strong{color:var(--text);display:block;margin-bottom:8px}

    .toast{
      position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);
      background:rgba(15,22,40,.95);backdrop-filter:blur(20px);
      border:1px solid var(--border);border-radius:999px;
      padding:12px 20px;display:flex;gap:10px;align-items:center;
      box-shadow:0 20px 50px -15px rgba(0,0,0,.5);
      z-index:100;opacity:0;
      transition:all .4s cubic-bezier(.4,0,.2,1);
    }
    .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
    .toast .msg{font-size:13px;font-weight:600}

    .mono{font-family:var(--mono)}
    .muted{color:var(--muted)}

    .score{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .score input{width:100px;text-align:center;font-weight:700}

    .weekbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:16px}

    .matchup-card{
      background:linear-gradient(145deg,rgba(255,255,255,.04),rgba(255,255,255,.01));
      border:1px solid var(--border);border-radius:16px;
      padding:16px;transition:all .3s ease;
    }
    .matchup-card:hover{border-color:rgba(99,102,241,.3);transform:translateX(4px)}
    .vs{color:var(--accent);font-weight:700;font-size:11px;text-transform:uppercase;letter-spacing:.1em}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>
  <div class="orb orb3"></div>

  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <div class="logo"></div>
          <div class="titleblock">
            <div class="title">
              <h1 id="leagueTitle">Commissioner Console</h1>
              <span class="pill" id="leagueSeason">Season</span>
            </div>
            <div class="subtitle">Manage your fantasy league with style</div>
          </div>
        </div>
        <div class="actions">
          <button class="btn" id="btnExport" title="Download backup">‚¨áÔ∏è Export</button>
          <button class="btn" id="btnImport" title="Import backup">‚¨ÜÔ∏è Import</button>
          <button class="btn danger" id="btnReset" title="Reset">üóëÔ∏è Reset</button>
          <button class="btn primary" id="btnSettings" title="Settings">‚öôÔ∏è Settings</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <aside class="panel">
        <div class="hd"><h2>Navigation</h2><span class="chip good" id="dataStatus">Saved</span></div>
        <nav class="nav" id="nav">
          <button class="tab" data-tab="dashboard" aria-selected="true"><span>Dashboard</span><small>Overview</small></button>
          <button class="tab" data-tab="teams" aria-selected="false"><span>Teams</span><small id="navTeamsMeta">0</small></button>
          <button class="tab" data-tab="schedule" aria-selected="false"><span>Schedule</span><small id="navScheduleMeta">0 wks</small></button>
          <button class="tab" data-tab="results" aria-selected="false"><span>Results</span><small id="navResultsMeta">Week 1</small></button>
          <button class="tab" data-tab="standings" aria-selected="false"><span>Standings</span><small>Live</small></button>
          <button class="tab" data-tab="notes" aria-selected="false"><span>Notes</span><small>Draft</small></button>
        </nav>
      </aside>

      <section class="panel content">
        <div class="hd">
          <h2 id="sectionTitle">Dashboard</h2>
          <div class="row">
            <span class="chip" id="weekChip">Week 1</span>
            <button class="btn small ghost" id="btnHelp">‚ùì Help</button>
          </div>
        </div>
        <div class="bd" id="view"></div>
      </section>
    </div>
  </main>

  <dialog id="dlgSettings">
    <div class="modal-hd"><h3>League Settings</h3><button class="btn small ghost" data-close>‚úï</button></div>
    <div class="modal-bd">
      <form class="form" id="formSettings">
        <div class="split">
          <div class="field"><label for="leagueName">League Name</label><input id="leagueName" name="leagueName" required placeholder="My Awesome League" /></div>
          <div class="field"><label for="seasonYear">Season Year</label><input id="seasonYear" name="seasonYear" type="number" min="2000" max="2100" required /></div>
        </div>
        <div class="split">
          <div class="field"><label for="regularWeeks">Regular Season Weeks</label><input id="regularWeeks" name="regularWeeks" type="number" min="1" max="30" required /><div class="hint">Used for schedule generation</div></div>
          <div class="field"><label for="tiebreaker">Tiebreaker</label><select id="tiebreaker" name="tiebreaker"><option value="pf">Points For (PF)</option><option value="pa">Points Against (PA)</option><option value="h2h">Head-to-Head</option></select></div>
        </div>
        <div class="field"><label for="playoffNotes">Playoff Notes</label><textarea id="playoffNotes" name="playoffNotes" placeholder="Top 6 make playoffs..."></textarea></div>
      </form>
    </div>
    <div class="modal-ft"><button class="btn" data-close>Cancel</button><button class="btn primary" id="btnSaveSettings">Save Changes</button></div>
  </dialog>

  <dialog id="dlgTeam">
    <div class="modal-hd"><h3 id="teamModalTitle">Team</h3><button class="btn small ghost" data-close>‚úï</button></div>
    <div class="modal-bd">
      <form class="form" id="formTeam">
        <input type="hidden" name="teamId" id="teamId" />
        <div class="split">
          <div class="field"><label for="teamName">Team Name</label><input id="teamName" name="teamName" required placeholder="The Touchdown Titans" /></div>
          <div class="field"><label for="teamOwner">Owner</label><input id="teamOwner" name="teamOwner" placeholder="John Doe" /></div>
        </div>
        <div class="split">
          <div class="field"><label for="teamAbbrev">Abbreviation</label><input id="teamAbbrev" name="teamAbbrev" maxlength="4" placeholder="TTT" /><div class="hint">Max 4 characters</div></div>
          <div class="field"><label for="teamColor">Color</label><input id="teamColor" name="teamColor" placeholder="#6366f1" /></div>
        </div>
      </form>
    </div>
    <div class="modal-ft"><button class="btn" data-close>Cancel</button><button class="btn danger" id="btnDeleteTeam" hidden>Delete</button><button class="btn primary" id="btnSaveTeam">Save Team</button></div>
  </dialog>

  <dialog id="dlgImport">
    <div class="modal-hd"><h3>Import Data</h3><button class="btn small ghost" data-close>‚úï</button></div>
    <div class="modal-bd">
      <div class="field"><label for="importText">Paste JSON</label><textarea id="importText" class="mono" placeholder='{"league":...}'></textarea><div class="hint">This will overwrite your current data</div></div>
    </div>
    <div class="modal-ft"><button class="btn" data-close>Cancel</button><button class="btn primary" id="btnDoImport">Import</button></div>
  </dialog>

  <dialog id="dlgHelp">
    <div class="modal-hd"><h3>Quick Guide</h3><button class="btn small ghost" data-close>‚úï</button></div>
    <div class="modal-bd">
      <div class="empty" style="text-align:left">
        <strong style="font-size:16px">How to use</strong>
        <div class="hint" style="margin-top:12px">
          <p><strong>Teams:</strong> Add and manage your league's teams</p>
          <p><strong>Schedule:</strong> Generate round-robin matchups automatically</p>
          <p><strong>Results:</strong> Enter scores each week</p>
          <p><strong>Standings:</strong> Auto-calculated rankings with your tiebreaker</p>
          <p style="margin-top:12px;opacity:.7">üí° Export regularly to backup your data</p>
        </div>
      </div>
    </div>
    <div class="modal-ft"><button class="btn primary" data-close>Got it!</button></div>
  </dialog>

  <div class="toast" id="toast"><div class="msg" id="toastMsg">Saved</div></div>

  <script>
    const STORE_KEY="ff_commish_v2";
    let state=loadState();
    const els={
      leagueTitle:document.getElementById('leagueTitle'),
      leagueSeason:document.getElementById('leagueSeason'),
      view:document.getElementById('view'),
      nav:document.getElementById('nav'),
      sectionTitle:document.getElementById('sectionTitle'),
      weekChip:document.getElementById('weekChip'),
      dataStatus:document.getElementById('dataStatus'),
      navTeamsMeta:document.getElementById('navTeamsMeta'),
      navScheduleMeta:document.getElementById('navScheduleMeta'),
      navResultsMeta:document.getElementById('navResultsMeta'),
      btnSettings:document.getElementById('btnSettings'),
      btnExport:document.getElementById('btnExport'),
      btnImport:document.getElementById('btnImport'),
      btnReset:document.getElementById('btnReset'),
      btnHelp:document.getElementById('btnHelp'),
      dlgSettings:document.getElementById('dlgSettings'),
      formSettings:document.getElementById('formSettings'),
      btnSaveSettings:document.getElementById('btnSaveSettings'),
      dlgTeam:document.getElementById('dlgTeam'),
      teamModalTitle:document.getElementById('teamModalTitle'),
      formTeam:document.getElementById('formTeam'),
      btnSaveTeam:document.getElementById('btnSaveTeam'),
      btnDeleteTeam:document.getElementById('btnDeleteTeam'),
      dlgImport:document.getElementById('dlgImport'),
      importText:document.getElementById('importText'),
      btnDoImport:document.getElementById('btnDoImport'),
      dlgHelp:document.getElementById('dlgHelp'),
      toast:document.getElementById('toast'),
      toastMsg:document.getElementById('toastMsg'),
    };
    let activeTab='dashboard',toastTimer=null;
    init();

    function init(){wireUI();renderShell();render()}

    function wireUI(){
      els.nav.addEventListener('click',e=>{const btn=e.target.closest('[data-tab]');if(btn)setTab(btn.dataset.tab)});
      document.addEventListener('click',e=>{const c=e.target.closest('[data-close]');if(c){const d=c.closest('dialog');if(d)d.close()}});
      els.btnSettings.addEventListener('click',()=>openSettings());
      els.btnSaveSettings.addEventListener('click',e=>{e.preventDefault();saveSettings()});
      els.btnExport.addEventListener('click',()=>doExport());
      els.btnImport.addEventListener('click',()=>openImport());
      els.btnReset.addEventListener('click',()=>doReset());
      els.btnDoImport.addEventListener('click',e=>{e.preventDefault();doImport()});
      els.btnHelp.addEventListener('click',()=>els.dlgHelp.showModal());
      els.btnSaveTeam.addEventListener('click',e=>{e.preventDefault();upsertTeamFromForm()});
      els.btnDeleteTeam.addEventListener('click',e=>{e.preventDefault();deleteTeamFromForm()});
    }

    function renderShell(){
      els.leagueTitle.textContent=state.league.name;
      els.leagueSeason.textContent=`${state.league.seasonYear}`;
      els.weekChip.textContent=`Week ${state.league.currentWeek}`;
      els.navTeamsMeta.textContent=`${state.teams.length}`;
      els.navScheduleMeta.textContent=`${state.schedule.length} wks`;
      els.navResultsMeta.textContent=`Week ${state.league.currentWeek}`;
    }

    function setTab(tab){
      activeTab=tab;
      els.nav.querySelectorAll('[data-tab]').forEach(t=>t.setAttribute('aria-selected',String(t.dataset.tab===tab)));
      const titles={dashboard:'Dashboard',teams:'Teams',schedule:'Schedule',results:'Results',standings:'Standings',notes:'Notes'};
      els.sectionTitle.textContent=titles[tab]||'Dashboard';
      render();
    }

    function render(){
      renderShell();
      if(activeTab==='dashboard')return renderDashboard();
      if(activeTab==='teams')return renderTeams();
      if(activeTab==='schedule')return renderSchedule();
      if(activeTab==='results')return renderResults();
      if(activeTab==='standings')return renderStandings();
      if(activeTab==='notes')return renderNotes();
    }

    function renderDashboard(){
      const teams=state.teams.length,weeks=state.schedule.length;
      const completed=countCompletedMatchups(),total=state.schedule.reduce((s,w)=>s+w.matchups.length,0);
      els.view.innerHTML=`
        <div class="kpi">
          <div class="card"><div class="label">Teams</div><div class="value">${teams}</div><div class="note">${teams<4?'Add more to get started':'Ready to play'}</div></div>
          <div class="card"><div class="label">Schedule</div><div class="value">${weeks}</div><div class="note">${weeks?'Weeks generated':'Generate matchups'}</div></div>
          <div class="card"><div class="label">Games</div><div class="value">${completed}/${total||0}</div><div class="note">Completed this season</div></div>
        </div>
        <div class="row space" style="margin-bottom:12px"><div class="hint">Quick actions to manage your league</div></div>
        <div class="row" style="gap:12px"><button class="btn" id="dashAddTeam">‚ûï Add Team</button><button class="btn primary" id="dashGenSched">üóìÔ∏è Generate Schedule</button></div>
      `;
      document.getElementById('dashAddTeam')?.addEventListener('click',()=>openTeamModal());
      document.getElementById('dashGenSched')?.addEventListener('click',()=>openGenerateScheduleModal());
    }

    function renderTeams(){
      const rows=state.teams.slice().sort((a,b)=>a.name.localeCompare(b.name)).map(t=>{
        const dot=t.color?`<span style="width:10px;height:10px;border-radius:50%;background:${esc(t.color)}"></span>`:'';
        return `<tr><td class="nowrap"><div class="row" style="gap:8px">${dot}<strong>${esc(t.name)}</strong>${t.abbrev?`<span class="chip mono">${esc(t.abbrev.toUpperCase())}</span>`:''}</div></td><td>${t.owner?esc(t.owner):'<span class="muted">‚Äî</span>'}</td><td class="num"><button class="btn small" data-edit-team="${t.id}">Edit</button></td></tr>`;
      }).join('');
      els.view.innerHTML=`
        <div class="row space" style="margin-bottom:12px"><div class="hint">Teams are the foundation of your league</div><button class="btn" id="btnAddTeam">‚ûï Add Team</button></div>
        ${state.teams.length===0?`<div class="empty"><strong>No teams yet</strong><div class="hint">Add teams to get started</div></div>`:`<div class="tablewrap"><table><thead><tr><th>Team</th><th>Owner</th><th class="num">Action</th></tr></thead><tbody>${rows}</tbody></table></div>`}
      `;
      document.getElementById('btnAddTeam')?.addEventListener('click',()=>openTeamModal());
      els.view.querySelectorAll('[data-edit-team]').forEach(btn=>btn.addEventListener('click',()=>openTeamModal(btn.getAttribute('data-edit-team'))));
    }

    function renderSchedule(){
      const weeks=state.schedule;
      els.view.innerHTML=`
        <div class="row space" style="margin-bottom:12px"><div class="hint">Generate or manually edit matchups</div><div class="row"><button class="btn" id="btnGenSchedule" ${state.teams.length>=2?'':'disabled'}>üóìÔ∏è Generate</button><button class="btn danger" id="btnClearSchedule" ${weeks.length?'':'disabled'}>üóëÔ∏è Clear</button></div></div>
        ${weeks.length===0?`<div class="empty"><strong>No schedule yet</strong><div class="hint">Click Generate to create matchups</div></div>`:weeks.map(w=>renderWeekCard(w,{editable:true,showScores:false})).join('')}
      `;
      document.getElementById('btnGenSchedule')?.addEventListener('click',()=>openGenerateScheduleModal());
      document.getElementById('btnClearSchedule')?.addEventListener('click',()=>{if(!confirm('Clear entire schedule?'))return;state.schedule=[];state.league.currentWeek=1;saveState('Schedule cleared');render()});
      els.view.querySelectorAll('[data-swap]').forEach(btn=>btn.addEventListener('click',()=>openSwapModal(Number(btn.getAttribute('data-week')),Number(btn.getAttribute('data-idx')))));
    }

    function renderResults(){
      const wc=state.schedule.length||state.league.regularWeeks,cur=clamp(state.league.currentWeek,1,Math.max(1,wc)),week=state.schedule.find(w=>w.week===cur);
      els.view.innerHTML=`
        <div class="weekbar"><button class="btn" id="wkPrev" ${cur<=1?'disabled':''}>‚Üê Prev</button><button class="btn" id="wkNext" ${cur>=wc?'disabled':''}>Next ‚Üí</button><span class="chip">Week ${cur}</span></div>
        ${!week?`<div class="empty"><strong>No matchups for Week ${cur}</strong><div class="hint">Create a schedule first</div></div>`:renderWeekCard(week,{editable:false,showScores:true,allowScoreEdit:true})+`<div class="row space" style="margin-top:14px"><div class="hint">Scores update standings automatically</div><div class="row"><button class="btn" id="btnMarkWeekComplete">‚úÖ Complete All</button><button class="btn" id="btnClearWeek">üóëÔ∏è Clear Scores</button></div></div>`}
      `;
      document.getElementById('wkPrev')?.addEventListener('click',()=>{state.league.currentWeek=cur-1;saveState(`Week ${state.league.currentWeek}`);render()});
      document.getElementById('wkNext')?.addEventListener('click',()=>{state.league.currentWeek=cur+1;saveState(`Week ${state.league.currentWeek}`);render()});
      els.view.querySelectorAll('[data-score]').forEach(input=>input.addEventListener('input',()=>{
        const w=Number(input.getAttribute('data-week')),idx=Number(input.getAttribute('data-idx')),side=input.getAttribute('data-side'),val=input.value.trim()===''?null:Number(input.value);
        const wo=state.schedule.find(x=>x.week===w);if(!wo)return;const m=wo.matchups[idx];if(!m)return;
        if(side==='home')m.homeScore=(val===null||Number.isNaN(val))?null:val;
        if(side==='away')m.awayScore=(val===null||Number.isNaN(val))?null:val;
        m.completed=(m.homeScore!==null&&m.awayScore!==null);saveState('Score updated',{silent:true});renderShell();
      }));
      els.view.querySelectorAll('[data-complete]').forEach(btn=>btn.addEventListener('click',()=>{
        const w=Number(btn.getAttribute('data-week')),idx=Number(btn.getAttribute('data-idx'));
        const wo=state.schedule.find(x=>x.week===w);if(!wo)return;const m=wo.matchups[idx];if(!m)return;
        m.completed=!m.completed;saveState(m.completed?'Marked complete':'Marked incomplete');render();
      }));
      document.getElementById('btnMarkWeekComplete')?.addEventListener('click',()=>{if(!week)return;week.matchups.forEach(m=>{if(m.homeId==='BYE'||m.awayId==='BYE'){m.completed=true;return}if(m.homeScore!==null&&m.awayScore!==null)m.completed=true});saveState('Week complete');render()});
      document.getElementById('btnClearWeek')?.addEventListener('click',()=>{if(!week||!confirm(`Clear scores for Week ${cur}?`))return;week.matchups.forEach(m=>{m.homeScore=null;m.awayScore=null;m.completed=(m.homeId==='BYE'||m.awayId==='BYE')});saveState('Scores cleared');render()});
    }

    function renderStandings(){
      const standings=computeStandings();
      const rows=standings.map((s,i)=>{const t=teamById(s.teamId),name=t?t.name:'(Unknown)',streak=renderStreakChip(s.streak);return `<tr><td class="num" style="font-weight:800;color:${i<3?'var(--accent2)':'var(--muted)'}">${i+1}</td><td><strong>${esc(name)}</strong></td><td>${t?.owner?esc(t.owner):'<span class="muted">‚Äî</span>'}</td><td class="num mono">${s.w}-${s.l}${s.t?`-${s.t}`:''}</td><td class="num mono">${fmtNum(s.pf)}</td><td class="num mono">${fmtNum(s.pa)}</td><td class="num mono" style="color:${s.pf-s.pa>=0?'var(--good)':'var(--danger)'}">${s.pf-s.pa>=0?'+':''}${fmtNum(s.pf-s.pa)}</td><td>${streak}</td></tr>`}).join('');
      els.view.innerHTML=`
        <div class="row space" style="margin-bottom:12px"><div class="hint">Sorted by W-L, then ${esc(state.league.tiebreaker.toUpperCase())}</div><button class="btn" id="btnRecalc">üîÑ Refresh</button></div>
        ${state.teams.length===0?`<div class="empty"><strong>No teams</strong></div>`:`<div class="tablewrap"><table><thead><tr><th class="num">#</th><th>Team</th><th>Owner</th><th class="num">Record</th><th class="num">PF</th><th class="num">PA</th><th class="num">Diff</th><th>Streak</th></tr></thead><tbody>${rows}</tbody></table></div>`}
      `;
      document.getElementById('btnRecalc')?.addEventListener('click',()=>{showToast('Refreshed');render()});
    }

    function renderNotes(){
      const notes=state.league.notes||'';
      els.view.innerHTML=`<div class="row space" style="margin-bottom:12px"><div class="hint">Personal notes, rules, payment tracking</div><button class="btn primary" id="btnSaveNotes">üíæ Save</button></div><div class="field"><label for="notesArea">Notes</label><textarea id="notesArea" placeholder="Add your notes...">${esc(notes)}</textarea></div>`;
      document.getElementById('btnSaveNotes')?.addEventListener('click',()=>{state.league.notes=document.getElementById('notesArea')?.value||'';saveState('Notes saved')});
    }

    function renderWeekCard(week,opts){
      const{editable,showScores,allowScoreEdit}=opts;
      const matchups=week.matchups.map((m,idx)=>{
        const home=labelTeam(m.homeId),away=labelTeam(m.awayId),isBye=m.homeId==='BYE'||m.awayId==='BYE',done=m.completed||isBye;
        const chip=done?`<span class="chip good">Done</span>`:`<span class="chip warn">Pending</span>`;
        const scores=showScores?`<div class="score"><input type="number" step="0.1" min="0" ${allowScoreEdit?'':'disabled'} value="${m.homeScore??''}" data-score data-week="${week.week}" data-idx="${idx}" data-side="home" placeholder="H" /><span class="muted">‚Äî</span><input type="number" step="0.1" min="0" ${allowScoreEdit?'':'disabled'} value="${m.awayScore??''}" data-score data-week="${week.week}" data-idx="${idx}" data-side="away" placeholder="A" /><button class="btn small" data-complete data-week="${week.week}" data-idx="${idx}">${done?'‚Ü©Ô∏é':'‚úì'}</button></div>`:'';
        const editBtn=editable?`<button class="btn small" data-swap data-week="${week.week}" data-idx="${idx}">Swap</button>`:'';
        return `<div class="matchup-card"><div class="row space"><div><div style="font-weight:700">${esc(home)}</div><div class="vs">vs</div><div style="font-weight:700">${esc(away)}</div></div><div class="row">${chip}${editBtn}</div></div>${scores}</div>`;
      }).join('');
      return `<div style="margin-bottom:16px"><div class="row space" style="margin-bottom:10px"><h3 style="margin:0;font-size:14px;font-weight:700">Week ${week.week}</h3><span class="chip">${week.matchups.length} games</span></div><div style="display:grid;gap:10px">${matchups}</div></div>`;
    }

    function openSettings(){
      els.formSettings.leagueName.value=state.league.name;
      els.formSettings.seasonYear.value=state.league.seasonYear;
      els.formSettings.regularWeeks.value=state.league.regularWeeks;
      els.formSettings.tiebreaker.value=state.league.tiebreaker;
      els.formSettings.playoffNotes.value=state.league.playoffNotes||'';
      els.dlgSettings.showModal();
    }

    function saveSettings(){
      const fd=new FormData(els.formSettings),name=String(fd.get('leagueName')||'').trim(),year=Number(fd.get('seasonYear')),weeks=Number(fd.get('regularWeeks')),tb=String(fd.get('tiebreaker')||'pf'),pn=String(fd.get('playoffNotes')||'').trim();
      if(!name)return showToast('Name required','bad');
      if(!Number.isFinite(year)||year<2000)return showToast('Invalid year','bad');
      if(!Number.isFinite(weeks)||weeks<1)return showToast('Weeks must be 1+','bad');
      state.league.name=name;state.league.seasonYear=year;state.league.regularWeeks=weeks;state.league.tiebreaker=tb;state.league.playoffNotes=pn;
      if(state.league.currentWeek<1)state.league.currentWeek=1;
      saveState('Settings saved');els.dlgSettings.close();render();
    }

    function openTeamModal(teamId){
      const editing=Boolean(teamId),t=editing?teamById(teamId):null;
      els.teamModalTitle.textContent=editing?'Edit Team':'Add Team';
      els.formTeam.teamId.value=t?.id||'';els.formTeam.teamName.value=t?.name||'';els.formTeam.teamOwner.value=t?.owner||'';els.formTeam.teamAbbrev.value=t?.abbrev||'';els.formTeam.teamColor.value=t?.color||'';
      els.btnDeleteTeam.hidden=!editing;els.dlgTeam.showModal();
    }

    function upsertTeamFromForm(){
      const fd=new FormData(els.formTeam),id=String(fd.get('teamId')||'').trim(),name=String(fd.get('teamName')||'').trim(),owner=String(fd.get('teamOwner')||'').trim(),abbrevRaw=String(fd.get('teamAbbrev')||'').trim(),color=String(fd.get('teamColor')||'').trim();
      if(!name)return showToast('Name required','bad');
      const abbrev=abbrevRaw?abbrevRaw.toUpperCase().slice(0,4):'';
      if(abbrev){const col=state.teams.find(t=>t.abbrev?.toUpperCase()===abbrev&&t.id!==id);if(col)return showToast('Abbreviation taken','bad')}
      if(id){const idx=state.teams.findIndex(t=>t.id===id);if(idx===-1)return showToast('Not found','bad');state.teams[idx]={...state.teams[idx],name,owner,abbrev,color};saveState('Team updated')}
      else{state.teams.push({id:uid(),name,owner,abbrev,color});saveState('Team added')}
      els.dlgTeam.close();render();
    }

    function deleteTeamFromForm(){
      const id=String(els.formTeam.teamId.value||'').trim();if(!id)return;
      const t=teamById(id),name=t?.name||'this team';
      if(!confirm(`Delete "${name}"? This will remove it from the schedule.`))return;
      state.teams=state.teams.filter(x=>x.id!==id);
      state.schedule.forEach(w=>{w.matchups.forEach(m=>{if(m.homeId===id)m.homeId='BYE';if(m.awayId===id)m.awayId='BYE';if(m.homeId==='BYE'||m.awayId==='BYE'){m.homeScore=null;m.awayScore=null;m.completed=true}})});
      saveState('Team deleted');els.dlgTeam.close();render();
    }

    function openImport(){els.importText.value='';els.dlgImport.showModal()}
    function doImport(){const raw=els.importText.value.trim();if(!raw)return showToast('Paste JSON','bad');try{state=validateState(JSON.parse(raw));saveState('Imported');els.dlgImport.close();setTab('dashboard')}catch(e){showToast('Invalid format','bad');console.error(e)}}
    function doExport(){const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'}),a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`${state.league.name.replace(/[^a-z0-9]/gi,'-').toLowerCase()||'league'}-${state.league.seasonYear}.json`;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(a.href);showToast('Exported')}
    function doReset(){if(!confirm('Reset everything? This cannot be undone.'))return;localStorage.removeItem(STORE_KEY);state=defaultState();saveState('Reset complete');setTab('dashboard')}

    function openGenerateScheduleModal(){
      if(state.teams.length<2)return showToast('Need 2+ teams','bad');
      const weeks=prompt(`How many weeks? (Suggested: ${state.league.regularWeeks})`,String(state.league.regularWeeks));if(weeks===null)return;
      const w=Number(weeks);if(!Number.isFinite(w)||w<1)return showToast('Invalid weeks','bad');
      const dbl=prompt('Double round-robin? (y/n)','n'),double=String(dbl||'').toLowerCase().startsWith('y');
      const shuf=prompt('Shuffle teams? (y/n)','y'),shuffle=String(shuf||'').toLowerCase().startsWith('y');
      if(state.schedule.length&&!confirm('Overwrite current schedule?'))return;
      state.schedule=generateRoundRobin(state.teams.map(t=>t.id),{weeks:w,double,shuffle});state.league.currentWeek=1;saveState('Schedule generated');setTab('schedule');
    }

    function openSwapModal(weekNum,matchupIdx){
      const week=state.schedule.find(w=>w.week===weekNum);if(!week)return;
      const m=week.matchups[matchupIdx];if(!m)return;
      const opts=['BYE',...state.teams.map(t=>t.id)];
      const newHome=prompt(`Week ${weekNum}: New home team (current: ${labelTeam(m.homeId)})`,labelTeam(m.homeId));if(newHome===null)return;
      const newAway=prompt(`New away team (current: ${labelTeam(m.awayId)})`,labelTeam(m.awayId));if(newAway===null)return;
      const homeId=resolveTeamInput(newHome,opts),awayId=resolveTeamInput(newAway,opts);
      if(!homeId||!awayId)return showToast('Team not found','bad');
      if(homeId===awayId)return showToast('Same team twice','bad');
      m.homeId=homeId;m.awayId=awayId;m.homeScore=null;m.awayScore=null;m.completed=(homeId==='BYE'||awayId==='BYE');saveState('Matchup updated');render();
    }

    function resolveTeamInput(input,validIds){const raw=String(input).trim();if(!raw)return null;if(raw.toUpperCase()==='BYE')return'BYE';let t=state.teams.find(x=>x.name.toLowerCase()===raw.toLowerCase());if(t)return t.id;t=state.teams.find(x=>(x.abbrev||'').toLowerCase()===raw.toLowerCase());if(t)return t.id;t=state.teams.find(x=>x.name.toLowerCase().includes(raw.toLowerCase()));if(t)return t.id;return null}

    function computeStandings(){
      const map=new Map();state.teams.forEach(t=>map.set(t.id,{teamId:t.id,w:0,l:0,t:0,pf:0,pa:0,games:[],streak:[]}));
      for(const w of state.schedule){for(const m of w.matchups){if(m.homeId==='BYE'||m.awayId==='BYE'||!m.completed||m.homeScore===null||m.awayScore===null)continue;const home=map.get(m.homeId),away=map.get(m.awayId);if(!home||!away)continue;home.pf+=m.homeScore;home.pa+=m.awayScore;away.pf+=m.awayScore;away.pa+=m.homeScore;home.games.push({opp:m.awayId,for:m.homeScore,against:m.awayScore});away.games.push({opp:m.homeId,for:m.awayScore,against:m.homeScore});if(m.homeScore>m.awayScore){home.w++;away.l++;home.streak.push('W');away.streak.push('L')}else if(m.homeScore<m.awayScore){home.l++;away.w++;home.streak.push('L');away.streak.push('W')}else{home.t++;away.t++;home.streak.push('T');away.streak.push('T')}}}
      const items=Array.from(map.values()).map(s=>({...s,streak:collapseStreak(s.streak)}));
      items.sort((a,b)=>{if(b.w!==a.w)return b.w-a.w;if(a.l!==b.l)return a.l-b.l;if(b.t!==a.t)return b.t-a.t;const tb=state.league.tiebreaker;if(tb==='pf'&&b.pf!==a.pf)return b.pf-a.pf;if(tb==='pa'&&a.pa!==b.pa)return a.pa-b.pa;if(tb==='h2h'){const h=h2h(a.teamId,b.teamId);if(h!==0)return h;if(b.pf!==a.pf)return b.pf-a.pf}const diffB=b.pf-b.pa,diffA=a.pf-a.pa;if(diffB!==diffA)return diffB-diffA;return(teamById(a.teamId)?.name||a.teamId).localeCompare(teamById(b.teamId)?.name||b.teamId)});
      return items;
    }

    function h2h(a,b){let aW=0,aL=0;for(const w of state.schedule){for(const m of w.matchups){if(!m.completed||m.homeScore===null||m.awayScore===null)continue;const isPair=(m.homeId===a&&m.awayId===b)||(m.homeId===b&&m.awayId===a);if(!isPair)continue;const aScore=m.homeId===a?m.homeScore:m.awayScore,bScore=m.homeId===a?m.awayScore:m.homeScore;if(aScore>bScore)aW++;else if(aScore<bScore)aL++}}if(aW+aL===0)return 0;return aW>aL?-1:aW<aL?1:0}
    function collapseStreak(list){if(!list.length)return'';const last=list[list.length-1];let n=0;for(let i=list.length-1;i>=0;i--){if(list[i]===last)n++;else break}return`${last}${n}`}
    function renderStreakChip(streak){if(!streak)return'<span class="chip">‚Äî</span>';const kind=streak.startsWith('W')?'good':streak.startsWith('L')?'bad':'warn';return`<span class="chip ${kind}">${esc(streak)}</span>`}
    function countCompletedMatchups(){let n=0;for(const w of state.schedule){for(const m of w.matchups){if(m.homeId==='BYE'||m.awayId==='BYE'||m.completed)n++}}return n}

    function generateRoundRobin(teamIds,{weeks,double,shuffle}){
      let ids=teamIds.slice();if(shuffle)ids=shuffleArray(ids);if(ids.length%2===1)ids.push('BYE');
      const n=ids.length,rounds=n-1,cycle=[];let arr=ids.slice();
      for(let r=0;r<rounds;r++){const matchups=[];for(let i=0;i<n/2;i++){const home=arr[i],away=arr[n-1-i],flip=r%2===1;matchups.push({homeId:flip?away:home,awayId:flip?home:away,homeScore:null,awayScore:null,completed:(home==='BYE'||away==='BYE')})}cycle.push(matchups);arr=rotateRR(arr)}
      let allRounds=cycle;if(double)allRounds=cycle.concat(cycle.map(ms=>ms.map(m=>({homeId:m.awayId,awayId:m.homeId,homeScore:null,awayScore:null,completed:(m.homeId==='BYE'||m.awayId==='BYE')}))));
      const out=[];for(let w=1;w<=weeks;w++){const ms=allRounds[(w-1)%allRounds.length];out.push({week:w,matchups:ms.map(m=>({...m}))})}return out;
    }
    function rotateRR(arr){const fixed=arr[0],rest=arr.slice(1);rest.unshift(rest.pop());return[fixed,...rest]}

    function loadState(){const raw=localStorage.getItem(STORE_KEY);if(!raw){const s=defaultState();s.teams=[{id:uid(),name:'Gridiron Gurus',owner:'Kris',abbrev:'GG',color:'#6366f1'},{id:uid(),name:'Waiver Wire Wizards',owner:'Jake',abbrev:'WWW',color:'#10b981'},{id:uid(),name:'Monday Night Miracles',owner:'Zoe',abbrev:'MNM',color:'#f59e0b'},{id:uid(),name:'Bye Week Bandits',owner:'Gina',abbrev:'BWB',color:'#f43f5e'}];return s}try{return validateState(JSON.parse(raw))}catch{return defaultState()}}
    function saveState(msg='Saved',opts={}){localStorage.setItem(STORE_KEY,JSON.stringify(state));els.dataStatus.textContent='Saved';if(!opts.silent)showToast(msg);renderShell()}
    function validateState(s){const d=defaultState();if(!s||typeof s!=='object')return d;const league=s.league&&typeof s.league==='object'?s.league:d.league;const teams=Array.isArray(s.teams)?s.teams:[];const schedule=Array.isArray(s.schedule)?s.schedule:[];const clean={league:{name:typeof league.name==='string'&&league.name.trim()?league.name.trim():d.league.name,seasonYear:Number.isFinite(Number(league.seasonYear))?Number(league.seasonYear):d.league.seasonYear,regularWeeks:Number.isFinite(Number(league.regularWeeks))?Number(league.regularWeeks):d.league.regularWeeks,tiebreaker:['pf','pa','h2h'].includes(league.tiebreaker)?league.tiebreaker:d.league.tiebreaker,playoffNotes:typeof league.playoffNotes==='string'?league.playoffNotes:'',notes:typeof league.notes==='string'?league.notes:'',currentWeek:Number.isFinite(Number(league.currentWeek))?Number(league.currentWeek):1},teams:teams.filter(t=>t&&typeof t==='object'&&typeof t.id==='string'&&typeof t.name==='string').map(t=>({id:t.id,name:String(t.name).trim()||'Unnamed',owner:typeof t.owner==='string'?t.owner.trim():'',abbrev:typeof t.abbrev==='string'?t.abbrev.trim().slice(0,4):'',color:typeof t.color==='string'?t.color.trim():''})),schedule:schedule.filter(w=>w&&typeof w==='object'&&Number.isFinite(Number(w.week))&&Array.isArray(w.matchups)).map(w=>({week:Number(w.week),matchups:w.matchups.filter(m=>m&&typeof m==='object'&&typeof m.homeId==='string'&&typeof m.awayId==='string').map(m=>({homeId:m.homeId,awayId:m.awayId,homeScore:(m.homeScore===null||m.homeScore===undefined||m.homeScore==='')?null:Number(m.homeScore),awayScore:(m.awayScore===null||m.awayScore===undefined||m.awayScore==='')?null:Number(m.awayScore),completed:Boolean(m.completed)||(m.homeId==='BYE'||m.awayId==='BYE')}))}))};clean.league.currentWeek=clamp(clean.league.currentWeek,1,Math.max(1,clean.schedule.length||clean.league.regularWeeks));return clean}
    function defaultState(){return{league:{name:'Fantasy Football League',seasonYear:new Date().getFullYear(),regularWeeks:14,tiebreaker:'pf',playoffNotes:'',notes:'',currentWeek:1},teams:[],schedule:[]}}

    function labelTeam(id){if(id==='BYE')return'BYE';const t=teamById(id);return t?t.abbrev?`${t.name} (${t.abbrev.toUpperCase()})`:t.name:'(Unknown)'}
    function teamById(id){return state.teams.find(t=>t.id===id)||null}
    function uid(){return crypto?.randomUUID?.()||`id_${Math.random().toString(16).slice(2)}_${Date.now()}`}
    function esc(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;')}
    function clamp(n,min,max){return Math.max(min,Math.min(max,n))}
    function fmtNum(n){const x=Number(n);return Number.isFinite(x)?x.toFixed(1).replace(/\.0$/,''):'0'}
    function shuffleArray(arr){const a=arr.slice();for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
    function showToast(msg,kind='good'){if(toastTimer)clearTimeout(toastTimer);els.toastMsg.textContent=msg;els.toast.classList.add('show');els.toast.style.borderColor=kind==='bad'?'rgba(244,63,94,.5)':kind==='warn'?'rgba(245,158,11,.5)':'rgba(16,185,129,.5)';toastTimer=setTimeout(()=>els.toast.classList.remove('show'),2500)}
  </script>
</body>
</html>
